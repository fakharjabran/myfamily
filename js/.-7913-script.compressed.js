/* SCRIPT COPYRIGHT - Raja Asim Akhtar */
(function(a){a.fn.tree_structure=function(b){var c={show_hide_option:true,add_option:true,edit_option:true,delete_option:true,animate_option:[true,5],fullwidth_option:true,align_option:"center",draggable_option:true};return this.each(function(){function A(a){a.prepend(l+m).children("div").prepend(p+r+q);if(a.children("ul").length!=0)a.hasClass("hide")?a.children("div").prepend(o):a.children("div").prepend(n);a.children("div").prepend(s)}function B(a){var b=a.children("div").outerWidth(true)/2;var c=a.children("div").offset().left;if(a.parents("li").offset()!=null)var d=a.parents("li").offset().top;vertical_height=a.offset().top-d-a.parents("li").children("div").outerHeight(true)/2;a.children("span.vertical").css({height:vertical_height,"margin-top":-vertical_height,"margin-left":b,left:c});if(a.parents("li").offset()==null){var e=0}else{var f=a.parents("li").children("div").offset().left+a.parents("li").children("div").width()/2;var g=c+a.children("div").width()/2;var e=f-g}var h=e<0?-Math.abs(e)+b:b;a.children("span.horizontal").css({width:Math.abs(e),"margin-top":-vertical_height,"margin-left":h,left:c})}function F(){a("."+t+" li").each(function(){if(u=="pageload")A(a(this));B(a(this))})}function G(a){if(a.length>0){a.children("div").addClass("parent");a=a.closest("li").closest("ul").closest("li");return G(a)}}if(b)a.extend(c,b);var d=c["show_hide_option"];var e=c["add_option"];var f=c["edit_option"];var g=c["delete_option"];var h=c["animate_option"];var i=c["fullwidth_option"];var j=c["align_option"];var k=c["draggable_option"];var l='<span class="vertical"></span>';var m='<span class="horizontal"></span>';var n=d==true?'<b class="hide"></b>':"";var o=d==true?'<b class="hide show"></b>':"";var p=e==true?'<span class="add_action" title="Click for Add"></span>':"";var q=f==true?'<span class="edit_action" title="Click for Edit"></span>':"";var r=g==true?'<span class="delete_action" title="Click for Delete"></span>':"";var s='<span class="highlight" title="Click for Highlight | Double-Click"></span>';var t=a(this).attr("class");var u="pageload";if(j!="center")a("."+t+" li").css({"text-align":j});if(i){var v=0;var w;var x;a("."+t+" li li").each(function(){var b=a(this).width();if(v==0||b>w){w=a(this).width();x=a(this)}v++});var y=x.closest("ul").children("li").eq(0).nextAll().length;var z=parseInt(0);for($i=0;$i<=y;$i++){z+=parseInt(x.closest("ul").children("li").eq($i).width())}a("."+t+"").closest("div").width(z)}a("."+t+" li.hide").each(function(){a(this).children("ul").hide()});if(h[0]==true){function C(){$timeout=setInterval(function(){E()},h[1])}var D=a("."+t+" li").length;var v=0;function E(){A(a("."+t+" li").eq(v));B(a("."+t+" li").eq(v));v++;if(v==D){v=0;clearInterval($timeout)}}}h[0]?C():F();u="others";a(window).resize(function(){F()});if(d){a("."+t+" b.hide").live("click",function(){a(this).toggleClass("show");a(this).closest("li").children("ul").toggle();F()})}a("."+t+" li > div").live("hover",function(b){if(b.type=="mouseenter"||b.type=="mouseover"){a("."+t+" li > div.current").removeClass("current");a("."+t+" li > div.children").removeClass("children");a("."+t+" li > div.parent").removeClass("parent");a(this).addClass("current");a(this).closest("li").children("ul").children("li").children("div").addClass("children");a(this).closest("li").closest("ul").closest("li").children("div").addClass("parent");a(this).children("span.highlight, span.add_action, span.delete_action, span.edit_action").show();var c=a(this).attr("id");a("span.notes").hide();if(a("#"+c+"_notes").length){a("#"+c+"_notes").show()}}else{a(this).children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide()}});a("."+t+" span.highlight").live("click",function(){a("."+t+" li.highlight").removeClass("highlight");a("."+t+" li > div.parent").removeClass("parent");a("."+t+" li > div.children").removeClass("children");a(this).closest("li").addClass("highlight");a(".highlight li > div").addClass("children");var b=a(this).closest("li").closest("ul").closest("li");G(b)});a("."+t+" span.highlight").live("dblclick",function(){if(i)a("."+t+"").parent("div").parent("div").scrollLeft(0);a("."+t+" li > div").not(".parent, .current, .children").closest("li").addClass("none");a("."+t+" li div b.hide.show").closest("div").closest("li").children("ul").addClass("show");a("."+t+" li div b.hide").addClass("none");a("body").prepend('<img src="img/goback.png" class="back_btn" alt="Go Back" title="Go Back" />');F();a(".back_btn").click(function(){a("."+t+" ul.show").removeClass("show");a("."+t+" li.none").removeClass("none");a("."+t+" li div b.hide").removeClass("none");a(this).remove();F()})});if(e){a("."+t+" span.add_action").live("click",function(){if(a(this).closest("div").children("form.edit_data").length==1)a(this).closest("div").children("form.edit_data").remove();var b='<form class="add_data"><img class="close" src="img/close.png" /><h3>Add Detail</h3><textarea></textarea><span class="submit">Submit</span></form>';if(a(this).closest("div").children("form.add_data").length==0){a(this).parent("div").append(b);a(this).closest("div").children("form").children("textarea").focus();a(this).closest("div").closest("li").closest("ul").children("li").children("div").addClass("zindex")}a("span.submit").click(function(){if(a(this).prev("textarea").val()!=""){var b;if(a(this).closest("li").children("ul").length>0){b=parseInt(a(this).closest("li").children("ul").children("li").last().children("div").attr("id"))+1}else{b=parseInt(a(this).closest("div").attr("id"))+1}var c='data={"action":"add", "id":"'+b+'", "html":"'+a(this).prev("textarea").val().replace(/\s+/g," ")+'", "parentid":"'+a(this).closest("div").attr("id")+'"}';a.ajax({type:"POST",url:"ajax.php",data:c,success:function(a){}});var d="<li>"+l+m+'<div id="'+b+'">'+s+p+r+q+a(this).prev("textarea").val()+"</div></li>";a(this).closest("li").children("ul").length>0?a(this).closest("li").children("ul").append(d):a(this).closest("li").append("<ul>"+d+"</ul>");a(this).closest("form.add_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide();a(this).closest("form.add_data").remove();a("li > div.zindex").removeClass("zindex");F();H()}else{a(this).prev("textarea").addClass("error")}});a("img.close").click(function(){a(this).closest("form.add_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide();a(this).closest("form.add_data").remove();a("li > div.zindex").removeClass("zindex")})})}if(g){a("."+t+" span.delete_action").live("click",function(){var b=a(this).closest("li").closest("ul").closest("li");var c=a(this).closest("li").children("ul").length==0?"Deleat This ?":"Deleat This with\nAll Child Element ?";var d=confirm(c);if(d){a(this).closest("li").addClass("ajax_delete_all");ajax_delete_id=Array();ajax_delete_id.push(a(this).closest("div").attr("id"));a(".ajax_delete_all li").each(function(){ajax_delete_id.push(a(this).children("div").attr("id"))});a(this).closest("li").removeClass("ajax_delete_all");var e='data={"action":"delete", "id":"'+ajax_delete_id+'"}';a.ajax({type:"POST",url:"ajax.php",data:e,success:function(a){}});a(this).closest("li").fadeOut().remove();F();if(b.children("ul").children("li").length==0)b.children("ul").remove()}})}if(f){a("."+t+" span.edit_action").live("click",function(){if(a(this).closest("div").children("form.add_data").length==1)a(this).closest("div").children("form.add_data").remove();var b=a(this).closest("div").clone();if(b.children("span.highlight").length>0)b.children("span.highlight").remove();if(b.children("span.delete_action").length>0)b.children("span.delete_action").remove();if(b.children("span.add_action").length>0)b.children("span.add_action").remove();if(b.children("span.edit_action").length>0)b.children("span.edit_action").remove();if(b.children("b.hide").length>0)b.children("b.hide").remove();var c='<form class="edit_data"><img class="close" src="img/close.png" /><h3>Edit Detail</h3><textarea>'+b.html()+'</textarea><span class="edit">Edit</span></form>';if(a(this).closest("div").children("form.edit_data").length==0){a(this).closest("div").append(c);if(a(this).closest("div").children("form").offset().top+a(this).closest("div").children("form").outerHeight()>a(window).height()){a(this).closest("div").children("form").css({"margin-top":-a(this).closest("div").children("form").outerHeight()})}if(a(this).closest("div").children("form").offset().left+a(this).closest("div").children("form").outerWidth()>a(window).width()){a(this).closest("div").children("form").css({"margin-left":-a(this).closest("div").children("form").outerWidth()})}a(this).closest("div").children("form").children("textarea").select();a(this).closest("div").closest("li").closest("ul").children("li").children("div").addClass("zindex")}a("span.edit").click(function(){if(a(this).prev("textarea").val()!=""){var b='data={"action":"edit", "id":"'+a(this).closest("div").attr("id")+'", "html":"'+a(this).prev("textarea").val().replace(/\s+/g," ")+'"}';a.ajax({type:"POST",url:"ajax.php",data:b,success:function(a){}});var c=a(this).closest("form.edit_data").closest("div");var d="";d=a(this).prev("textarea").val();c.children("span.edit_action").nextAll().remove();if(c.text().length>0)c.html(c.html().replace(c.text(),""));c.append(d);c.children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide();a("li > div.zindex").removeClass("zindex");F()}else{a(this).prev("textarea").addClass("error")}});a("img.close").click(function(){a(this).closest("form.edit_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide();a(this).closest("form.edit_data").remove();a("li > div.zindex").removeClass("zindex")})})}if(k){function H(){a("."+t+" li > div").draggable({cursor:"move",distance:40,zIndex:5,revert:true,revertDuration:100,snap:".tree li div",snapMode:"inner",start:function(b,c){a("li.li_children").removeClass("li_children");a(this).closest("li").addClass("li_children")},stop:function(a,b){I()}})}function I(){a("."+t+" li > div").droppable({accept:".tree li div",drop:function(b,c){a("div.check_div").removeClass("check_div");a(".li_children div").addClass("check_div");if(a(this).hasClass("check_div")){alert("Cant Move on Child Element.")}else{var d='data={"action":"drag", "id":"'+a(c.draggable[0]).attr("id")+'", "parentid":"'+a(this).attr("id")+'"}';a.ajax({type:"POST",url:"ajax.php",data:d,success:function(a){}});a(this).next("ul").length==0?a(this).after("<ul><li>"+a(c.draggable[0]).attr({style:""}).closest("li").html()+"</li></ul>"):a(this).next("ul").append("<li>"+a(c.draggable[0]).attr({style:""}).closest("li").html()+"</li>");a(c.draggable[0]).closest("ul").children("li").length==1?a(c.draggable[0]).closest("ul").remove():a(c.draggable[0]).closest("li").remove();F();H()}}})}a("."+t+" li > div").disableSelection();H()}})}})(jQuery)